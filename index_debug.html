<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM fully loaded");
            
            // First verify forms exist before setting up listeners
            const studentForm = document.getElementById('studentLoginForm');
            const facultyForm = document.getElementById('facultyLoginForm');
            
            if (!studentForm) console.error("Student login form not found");
            if (!facultyForm) console.error("Faculty login form not found");

            // Load auth.js immediately
            const script = document.createElement('script');
            script.src = 'auth_debug_v4.js';
            
            script.onload = function() {
                console.log("auth_debug_v4.js loaded successfully");
                
                // Verify forms are accessible
                console.log("Student form exists:", !!studentForm);
                console.log("Faculty form exists:", !!facultyForm);
                
                // Setup form event listeners
                function setupFormListeners() {
                    try {
                        if (studentForm) {
                            // Enhanced submit event listener with more debugging
                            const enhancedSubmitHandler = function(e) {
                                console.log("===== FORM SUBMIT EVENT TRIGGERED =====");
                                console.log("Event details:", {
                                    type: e.type,
                                    target: e.target,
                                    currentTarget: e.currentTarget
                                });
                                e.preventDefault();
                                console.log("Calling handleLogin with complete event object");
                                handleLogin(e);
                            };
                            studentForm.addEventListener('submit', enhancedSubmitHandler);
                            console.log("Enhanced submit listener added to student form");

                            // Verify and log all form elements
                            console.log("Student form elements:", {
                                username: studentForm.querySelector('#studentUsername'),
                                password: studentForm.querySelector('#studentPassword'),
                                submitBtn: studentForm.querySelector('button[type="submit"]')
                            });

                            // Enhanced click listener for submit button
                            const studentSubmitBtn = studentForm.querySelector('button[type="submit"]');
                            if (studentSubmitBtn) {
                                const enhancedClickHandler = function(e) {
                                    console.log("===== SUBMIT BUTTON CLICK EVENT =====");
                                    console.log("Event details:", e);
                                    e.preventDefault();
                                    console.log("Calling handleLogin with synthetic event");
                                    handleLogin({
                                        type: 'submit',
                                        target: studentForm,
                                        preventDefault: () => console.log("Default prevented")
                                    });
                                };
                                studentSubmitBtn.addEventListener('click', enhancedClickHandler);
                                console.log("Enhanced click listener added to submit button");
                            }
                        }
                        
                        if (facultyForm) {
                            // Similar enhanced listeners for faculty form
                            facultyForm.addEventListener('submit', function(e) {
                                console.log("Faculty form submit event triggered");
                                e.preventDefault();
                                console.log("Calling handleLogin...");
                                handleLogin(e);
                            });
                            
                            const facultySubmitBtn = facultyForm.querySelector('button[type="submit"]');
                            if (facultySubmitBtn) {
                                facultySubmitBtn.addEventListener('click', function(e) {
                                    console.log("Faculty submit button clicked");
                                    e.preventDefault();
                                    handleLogin({target: facultyForm});
                                });
                            }
                        }

                        // Setup Google login buttons
                        const studentGoogleBtn = document.getElementById('studentGoogleLogin');
                        const facultyGoogleBtn = document.getElementById('facultyGoogleLogin');
                        
                        if (studentGoogleBtn) {
                            studentGoogleBtn.onclick = handleGoogleLogin;
                        }
                        
                        if (facultyGoogleBtn) {
                            facultyGoogleBtn.onclick = handleGoogleLogin;
                        }
                    } catch (error) {
                        console.error("Error setting up event listeners:", error);
                    }
                }

                // Call setup immediately
                setupFormListeners();
            };
            
            script.onerror = function() {
                console.error("Failed to load auth_debug_v4.js");
            };
            
            document.head.appendChild(script);
        });
    </script>
    <title>Welcome To EnrollmentPRO - Debug Version</title>
</head>
<body>
    <article name="a1">
        <div class="container">
            <nav class="navbar">
                <header class="header">
                    <h1 onclick="window.location.href='index.html'">EnrollmentPRO</h1>
                </header>
                <div class="b1">
                    <button class="button" href="index.html">Home</button>
                    <button class="button">About Us</button>
                    <button class="button">Info</button>
                </div>
            </nav>
            <div class="message-container">
                <h1>
                    Greetings, this is the enrollment website for SRMIST students!
                    This platform enables students to virtually complete their enrollment in a seamless manner.
                    To proceed with the enrollment, select from the two options below:
                </h1>
                <form class="login-form" id="studentLoginForm" style="display:none;">
                    <input type="text" id="studentUsername" placeholder="Student ID" required>
                    <input type="password" id="studentPassword" placeholder="Password" required>
                    <button type="submit" class="button">Submit</button>
                    <button type="button" class="button" id="studentGoogleLogin">Login with Google</button>
                    <button type="button" class="button" onclick="window.location.href='student_login.html'">Advanced Login</button>
                </form>
                <form class="login-form" id="facultyLoginForm" style="display:none;">
                    <input type="text" id="facultyUsername" placeholder="Faculty ID" required>
                    <input type="password" id="facultyPassword" placeholder="Password" required>
                    <button type="submit" class="button">Submit</button>
                    <button type="button" class="button" id="facultyGoogleLogin">Login with Google</button>
                    <button type="button" class="button" onclick="window.location.href='faculty_login.html'">Advanced Login</button>
                </form>
                <button class="button" id="studentLoginBtn" onclick="document.getElementById('studentLoginForm').style.display='block'">Login (for students)</button>
                <button class="button" id="facultyLoginBtn" onclick="document.getElementById('facultyLoginForm').style.display='block'">Login (for Faculty advisor)</button>
                <h2>
                    We are excited to assist you in your enrollment journey! 
                    Our platform is designed to provide you with all the necessary tools and information to make your enrollment process smooth and efficient.
                </h2>
            </div>
        </div>
        <footer>
            <h2>
                Feel free to explore the various resources available to you, including FAQs and support services.
            </h2>
        </footer>
    </article>
</body>
</html>
